# Уравнение фильтрации

Уравнение фильтрации жидкости (нефти) в пористой среде - математическая модель пласта часто использующаяся в инженерных приложениях.



::: callout-tip
## Уравнение фильтрации в единицах измерений СИ
$$ 
    \frac{\partial ^2 p }{\partial r^2} + \frac{1}{r} \frac{\partial p}{\partial r} = \frac{\varphi \mu c_t}{k} \frac{\partial p}{\partial t} 
$$ {#eq-diff_eq_1}
:::

Здесь используются следующие обозначения:

-   $u_x$ - скорость фильтрации в направлении $x$, м/сек
-   $k$ - проницаемость, м^2^
-   $\mu$ - вязкость флюида, Па с
-   $p$ - давление, Па
-   $x$ - расстояние, м
-   $\rho$ - плотность флюида, кг/м^3^
-   $\varphi$ - пористость породы, доли единиц.
-   $c_t$ - общая сжимаемость породы и флюида, 1/Па
-   $t$ - время, сек


Иногда бывает удобно записать уравнение используя другие единицы измерения, например практические метрические - уравнение примет вид:

::: callout-tip
## Уравнение фильтрации в практических метрических единицах измерений

$$ 
    \frac{\partial ^2 p }{\partial r^2} + \frac{1}{r} \frac{\partial p}{\partial r} = \frac{\varphi \mu c_t}{0.00036 k} \frac{\partial p}{\partial t} 
$$ {#eq-diff_eq_2}

:::

-   $k$ - проницаемость, мД
-   $\mu$ - вязкость флюида, сП
-   $p$ - давление, атм
-   $r$ - расстояние, м
-   $\rho$ - плотность флюида, кг/м^3^
-   $\varphi$ - пористость породы, доли единиц.
-   $c_t$ - общая сжимаемость породы и флюида, 1/атм
-   $t$ - время, час


## Вывод уравнения фильтрации 


Как правило, при выводе уравнения фильтрации используются следующие соотношения:

1.  закон Дарси - определяет линейную зависимость скорости фильтрации от перепала давления:

$$ 
u_x=-\frac{k}{\mu}\frac{dp}{dx} 
$$ {#eq-darcy_law_1}

2.  уравнение неразрывности - или закон сохранения массы, показывает что в потоке не могут образовываться разрывы сплошности: 

$$  
\frac{\partial\left(\rho u_x\right)}{\partial x}= - \frac{\partial (\varphi \rho)}{\partial t} 
$$ {#eq-mass_balance_1}

3.  уравнение состояния флюида - задает зависимость свойств флюида, в частности плотности, от давления: 

$$   
 c_0=\frac{1}{\rho}\frac{\partial\rho}{\partial p} 
$$ {#eq-eos_1}

Опираясь на эти соотношения уравнение фильтрации в радиальной форме можно привести (для величин СИ) к виду (-@eq-diff_eq_1): 

Предположения используемые при выводе уравнения:

-   пласт однородный и изотропный - пористость и проницаемость одинаковы во всем пласте и во всех направлениях и не зависят от давления
-   добывающая скважина вскрывает весь продуктивный горизонт и обеспечивает радиальный приток к скважине
-   пласт насыщен одним флюидом на всем протяжении
-   температура не меняется в пласте, изотермичность


## Вывод уравнения фильтрации для линейного потока
Приведем вывод уравнения фильрации для линейного и радиального потока

Выпишем эти уравнения, чтобы разобраться. В уравнениях будем придерживаться обозначений принятых в международной литературе, в частности в публикациях общества инженеров нефтяников SPE. Описание обозначений, а также единиц измерения можно найти в @erlagerGidrodinamicheskieMetodyIssledovaniya2006. Особое внимание на данном этапе стоит обратить на размерные коэффициенты в уравнениях. С одной стороны записывая уравнения в СИ их можно упростить и избежать части сложностей с переводными коэффициентами. С другой стороны во многих источниках переводные коэффициенты интесивно используются и это оказывается удобно при программной реализации алгоритмов. В данном описании приведем перевод коэффициентов в практические метрические единицы.

**Закон сохранения массы**

В дифференциальной форме, для потока в направлении $x$

$$
-f_1 \dfrac{\partial (\rho  u_x)}{\partial x} = \dfrac{\partial(\rho \varphi)}{\partial t} 
$$ {#eq-mass_conserv_0}

$$
-f_1 \dfrac{\partial (\rho q_x)}{\partial x} = A \dfrac{\partial(\rho \varphi)}{\partial t} 
$$ {#eq-mass_conserv_1}

где

-   $f_1$ - размерный коэффициент, для практических метрических единиц $f_1= 0.04167$, для американских промысловых $f_1 = 0.23394$, для СИ $f_1=1$
-   $\rho$ - плотность флюида, кг/м^3^, lbm/ft^3^
-   $q_x$ - объемный расход в направлении $x$, м^3^/сут, bbl/day, учитываем для практических метрических единиц $1$ м^3^/сут $= 0.04167$ м^3^/час и для промысловых американских $1$ bbl/day $= 0.23394$ ft^3^/hr\
-   x - координата, м, ft
-   $\varphi$ - пористость, доли единиц
-   $t$ - время, часы
-   $A$ - площадь, м^2^, ft^2^

В перечне указаны размерности для промысловых метрических и американских промысловых единиц измерений, там где они отличаются.

Для практических метрических единиц ([-@eq-mass_conserv_1]) можно записать в виде 

$$
-0.04167 \dfrac{ \partial (\rho q_x) }{\partial x} = A \dfrac{\partial(\rho \varphi)}{\partial t} 
$$ {#eq-mass_conserv_2}

**Закон Дарси**

Простейшим вариантом задания зависимости между измением давления и потоком флюида является линейная зависимость - закон Дарси. При этом линейный множитель в зависимости - функция как коллектора (проницаемость), так и свойств флюида (вязкость).

Закон Дарси в направлении $x$. 

$$ 
u_x = -  \dfrac{k_x }{f_2\mu} \dfrac{\partial p}{\partial x} 
$$ {#eq-darcy_law_0}

$$ 
q_x = -  \dfrac{k_x A}{f_2\mu} \dfrac{\partial p}{\partial x} 
$$ {#eq-darcy_law_2}

где

-   $f_2$ - размерный коэффициент, для практических метрических единиц $f_2= 115.74$, для американских промысловых $f_2 = 887.2$, для СИ $f_2=1$
-   $k_x$ - проницаемость в направлении движения потока, мД
-   $A$ - площадь, м^2^, ft^2^
-   $\mu$ - динамическая вязкость, сП
-   $p$ - давление, атм, psi
-   $x$ - координата движения потока, м

В практических метрических единицах измерения ([-@eq-darcy_law_2]) будет иметь вид 

$$ 
q_x = -  \dfrac{k_x A}{115.74\mu} \dfrac{\partial p}{\partial x} 
$$ {#eq-darcy_law_3}

Пытаясь проверить корректность вывода переводных коэффициентов необходимо учесть что для единиц измерение СИ получим $f=1$, а необходимые переводные коэффициенты можно записать как:

-   $q$: $1$ [м^3^/сек] = $543439$ [bbl/day] = $86400$ [м^3^/сут]
-   $k$: $1$ [м^2^] = $1.01325 \cdot 10^{15}$ [мД]
-   $\mu$: $1$ [Па$\cdot$с] = $1000$ [сП]
-   $p$: $1$ [Па] = $0.0001450$ [psi] = $0.00000987$ [атм]
-   $x$: $1$ [м] = $3.28$ [ft]
-   $A$: $1$ [м^2^] = $10.76$ [ft^2^]

**Уравнение состояния**

В простейшем варианте, который мы будет изучать, предполагается, что сжимаемость постоянна и мала

$$
c_t = c_{formation} + c_{fluid} = const
$$ {#eq-eos_2}

-   $c_t$ - общая сжимаемость (total compressibility)
-   $c_{formation}$ - сжимаемость породы (formation compressibility), $c_{formation} = \dfrac{1}{\varphi}\dfrac{\partial \varphi}{\partial p}$
-   $c_{fluid}$ - сжимаемость флюида (fluid compressibility), $c_{fluid} = \dfrac{1}{\rho}\dfrac{\partial \rho}{\partial p}$

**Уравнение фильтрации**

Подставим выражение для закона Дарси ([-@eq-darcy_law_3]) в уравнение мат баланса ([-@eq-mass_conserv_2])

$$ 
0.04167 \dfrac{ \partial}{\partial x} { \left[ \rho   \dfrac{k_x A}{115.74\mu} \dfrac{\partial p}{\partial x} \right] } = A \dfrac{\partial(\rho \varphi)}{\partial t}  
$$ {#eq-diff_eq_2_}

Упрощая ([-@eq-diff_eq_2]) получим

$$ 
\frac{\partial (\rho \varphi)}{\partial t} = 0.00036 k_x \dfrac{ \partial}{\partial x}\left[ \dfrac{\rho}{\mu}\dfrac{\partial p}{\partial x} \right] 
$$ {#eq-diff_eq_3}

Уравнение ([-@eq-diff_eq_3]) подходит для потока газа. Для жидкости, предполагая малую сжимаемость флюида можно его упростить до вида

$$ 
\frac{\partial p}{\partial t} = 0.00036 \dfrac{k_x}{\varphi \mu c_t} \dfrac{ \partial^2 p}{\partial x^2} 
$$ {#eq-diff_eq_4}

Напомним, здесь

-   $p$ - давление, атм
-   $t$ - время, час
-   $k_x$ - проницаемость в направлении движения потока, мД
-   $\mu$ - динамическая вязкость, сП
-   $\varphi$ - пористость, д.е.
-   $c_t$ - сжимаемость, 1/атм
-   $x$ - расстояние, м

Приведенное уравнение ([-@eq-diff_eq_4]) соответствует линейному потоку в пласте. Практический интерес представляет решение для радиального потока

## Вывод уравнения фильтрации для радиального потока

![Схема радиального притока к скважине](images/paste-2.png){#fig-rad_model_image_1 width=50%}

**Закон сохранения массы**

Закон сохранения массы или принцип неразрывности можно выразить в радиальной форме следующим соотношением

$$ 
\frac{1}{r}\frac{\partial\left(r\rho u_r\right)}{\partial r}=-\frac{\partial \rho \varphi }{\partial t}
$$ {#eq-mass_balance_2}

Принцип неразрывности показывает, что для определенного объема пласта, масса флюида которое втекла в контрольный объем пласта минус масса которая вытекла равна массе которая накопилась в объеме.

Сохранение импульса или закон Дарси можно выразить соотношением

$$ 
 u_r=-\frac{k}{\mu}\frac{d^p}{dr}
$$ {#eq-darcy_law_4}

Закон Дарси здесь используется как псевдоустановившаяся аппроксимация обобщенного уравнения сохранения импульса (то есть слагаемым отвечающим за накопление импульса пренебрегаем). Это предположение справедливо если не учитывать возмущения давления в среде двигающиеся со скоростью звука. Все изменения давления описываемые моделью связаны с локальными изменениями градиента давления за счет ламинарного режима потока. Хотя далее в модели будет учтена сжимаемость системы всеми "звуковыми" эффектами в системе мы пренебрегаем.

Поток предполагается горизонтальным, поэтому давление $p$ может быть использовано в качестве потенциала потока, гравитационными силами пренебрегаем.

Комбинируя уравнения ([-@eq-mass_balance_2]) , ([-@eq-darcy_law_4]) получим:

$$ 
\frac{1}{r}\frac{\partial }{\partial r} \left( \dfrac{r\rho k}{\mu}\dfrac{\partial p}{dr}\right) =\varphi\frac{\partial \rho}{\partial t}
$$ {#eq-diff_eq_rad_1}

Уравнение ([-@eq-diff_eq_rad_1]) -- дифференциальное уравнение в частных производных описывающее нестационарный поток однофазного флюида в пористой среде при ламинарном потоке.

Вообще говоря приведенное уравнение является нелинейным, так как плотность $\rho = \rho(p)$ и вязкость $\mu = \mu(p)$ являются функциями давления. Уравнение содержит две зависимые переменные - давление $p$ и плотность $\rho$. Поэтому для его решения необходимо задать еще одно соотношение, каковым может быть уравнение состояния флюида связывающее плотность флюида и давление $\rho = \rho(p)$.

**Флюид постоянной сжимаемости**

Нестационарное поведение давления в пласте связано со сжимаемостью системы. При изменении давления в какой то точке, часть флюида сжимается, происходит накопление или отдача флюида, что вызывает задержку в распространении изменения флюида. Несмотря на то, что сжимаемость флюидов и породы малы и во многих случаях ими можно пренебречь, это не верно для пластовых систем для добычи нефти. Большие объемы пласта и флюидов и высокие давления компенсируют малость сжимаемости и требуют ее учета.

Для однофазного флюида разумным является предположение постоянства сжимаемости.

Сжимаемость можно определить как

$$
c=-\frac{1}{V} \left(  \frac{ \partial V}{ \partial p}  \right) 
$$

учтем, что

$$
 \rho = \frac{m}{V} 
$$

тогда получим

$$
c=\frac{1}{\rho} \left(  \frac{ \partial \rho}{ \partial p}  \right) 
$$

Для флюида с постоянной сжимаемостью, проинтегрировав приведенное уравнение можно получить

$$
\rho = \rho_i e^{c(p-p_i)}
$$

где $\rho_i$ плотность флюида при некотором заданном давлении $p_i$

Продифференцировав выражение для плотности по времени получим

$$
c \rho \frac{\partial p}{\partial t} = \frac{\partial \rho}{\partial t}
$$

Подставив это выражение в ранее полученное уравнение фильтрации ([-@eq-diff_eq_rad_1]) получим

$$ 
\frac{1}{r}\frac{\partial\left( \dfrac{r\rho k}{\mu}\dfrac{\partial p}{dr}\right)}{\partial r}=\varphi c \rho \frac{\partial p}{\partial t}  
$$ {#eq-diff_eq_rad_2}

Приведенное дифференциальное уравнение в частных производных все еще нелинейно, поскольку зависит от плотности $\rho$

**Общая сжимаемость**

Если пористость не является постоянной величиной и меняется с давлением, тогда слагаемое отвечающее за накопление флюида в пласте можно выразить как

$$
\frac{\partial \varphi \rho}{\partial t} = \varphi \frac{\partial \rho}{\partial t}+ \rho \frac{\partial \varphi }{\partial t} = \varphi c_l \rho \frac{\partial p}{\partial t} + \rho \frac{\partial \varphi }{\partial t}  
$$

где $c_l$ сжимаемость жидкости.

Определим сжимаемость породы как

$$
c_f = \frac{1}{\varphi} \frac{\partial \varphi}{\partial p}
$$

тогда

$$
\frac{\partial \varphi \rho}{\partial t}  = \varphi \rho (c_l + c_f) \frac{\partial p}{\partial t}   
$$

хотя пористость здесь является функцией давления - в первом приближении мы можем считать ее константой равной пористости при некотором среднем давлении в пласте. Это справедливо для маленькой сжимаемости породы, что верно почти всегда.

Уравнение для сжимаемости можно еще уточнить, учтя что в пласте могут находится различные флюиды - вода и нефть с насыщенностями $s_w$ и $s_o$

тогда

$$ 
c_l = s_o c_o + s_w c_w 
$$

тогда можно ввести общую сжимаемость системы

$$
 c_t = c_l + c_f = s_o c_o + s_w c_w  + c_f 
$$

Заметим, что проницаемость k в законе Дарси это не абсолютная проницаемость, но относительная проницаемость по нефти при насыщенности водой соответствующей связанной воде.

$$ 
k= k_o (s_{wc}) 
$$

**Линеаризация уравнения фильтрации**

Раскрыв производную в левой части ([-@eq-diff_eq_rad_2]) и предположив, что $\dfrac{\partial p}{\partial r}$ мало а следовательно слагаемым $r \rho c_t \left( \dfrac{\partial p}{\partial r} \right)^2$ можно пренебречь, получим линеаризованное уравнения фильтрации

$$
\frac{\partial^2 p}{\partial r^2} + \frac{1}{r} \frac{\partial p}{\partial r}= \frac{\varphi \mu c_t}{k} \frac{\partial p}{\partial t}
$$ {#eq-diff_eq_lin}

## Безразмерные переменные {#sec-dimensionless_vars_definitions}


Часто для анализа уравнений неустановившейся фильтрации используются безразмерные переменные. Мы будем использовать переменные в виде:


::: callout-tip
### Определение безразмерных переменных в единицах СИ

$$ 
r_D = \frac{r}{r_w} 
$$ {#eq-def_rd_si}

$$ 
t_D = \frac{kt}{\varphi \mu c_t r_w^2}
$$ {#eq-def_td_si}

$$ 
p_D = \frac{2 \pi kh}{q_{ref} B \mu} \left( p_i - p \right) 
$$ {#eq-def_pd_si}

$$ 
q_D = \frac{q}{q_{ref}} 
$$ {#eq-def_qd_si}
:::

Здесь использованы единицы измерения СИ.

- $r_w$ - радиус скважины, м
- $r$ - расстояние от центра скважины до точки в пласте, м
- $q_{ref}$ - референсный дебит скважины на поверхности, приведенный к нормальным условиям м^3^/с
- $\varphi$ - пористость, доли единиц
- $\mu$ - вязкость нефти в пласте, Па с
- $B$ - объемный коэффициент нефти, м^3^/м^3^
- $p_i$ - начальное давление в пласте, Па
- $p$ - давление забойное, Па
- $c_t$ - общая сжимаемость системы в пласте, 1/Па
- $k$ - проницаемость, мД
- $t$ -  время, час

Использование безразмерных переменных позволяет упростить уравнение фильтрации, которое примет вид

$$ 
\frac{\partial p_D}{ \partial t_D} = \dfrac{1}{r_D} \left[ \dfrac{\partial}{\partial r_D} \left( r_D \dfrac{ \partial p_D} {\partial r_D} \right) \right] 
$$

Решение этого уравнения - функция безразмерного давления от безразмерных времени, расстояния и дебита $p_D(r_D, t_D, q_D)$

Для практических расчетов удобнее бывает использовать безразмерные переменные полученные для практических метрических единиц измерения.

::: callout-tip
### Определение безразмерных переменных в практических метрических единицах

$$ 
r_D = \frac{r}{r_w} 
$$ {#eq-def_rd_metric}

$$ 
t_D = \frac{0.00036 kt}{\varphi \mu c_t r_w^2}
$$ {#eq-def_td_metric}

$$ 
p_D = \frac{kh}{ 18.42 q_{ref} B \mu} \left( p_i - p \right) 
$$ {#eq-def_pd_metric}

$$ 
q_D = \frac{q}{q_{ref}} 
$$ {#eq-def_qd_metric}

:::

Здесь использованы практические метрические единицы измерения.

-   $r_w$ - радиус скважины, м
-   $r$ - расстояние от центра скважины до точки в пласте, м
-   $q_s$ - референсный дебит скважины на поверхности, приведенный к нормальным условиям м^3^/сут
-   $\varphi$ - пористость, доли единиц
-   $\mu$ - вязкость нефти в пласте, сП
-   $B$ - объемный коэффициент нефти, м^3^/м^3^
-   $p_i$ - начальное давление в пласте, атм
-   $p_{wf}$ - давление забойное, атм
-   $c_t$ - общая сжимаемость системы в пласте, 1/атм


Уравнение фильтрации для радиального потока в линеаризованном виде можно записать в виде

$$ 
\frac{\partial p}{\partial t} = 0.00036 \dfrac{k}{\varphi \mu c_t} \dfrac{1}{r} \left[ \dfrac{\partial}{\partial r} \left( r \dfrac{ \partial p} {\partial r} \right) \right]  
$$

Использование безразмерных переменных позволяет упростить уравнение фильтрации, которое примет вид

$$ 
\frac{\partial p_D}{ \partial t_D} = \dfrac{1}{r_D} \left[ \dfrac{\partial}{\partial r_D} \left( r_D \dfrac{ \partial p_D} {\partial r_D} \right) \right] 
$$

Решение этого уравнения - функция безразмерного давления от безразмерных времени, расстояния и дебита $p_D(r_D, t_D, q_D)$

Для построения частного решения уравнения фильтрации необходимо задать начальные и граничные условия.

Для расчетов в размерных переменных необходимо определить функции перевода размерных координаты в безразмерные и обратно. Приведем пример определелие таких функций с использованием python. В дальнейшем при необходимости перевода размерных единиц в размерные и безразмерные будет использовать реализацию этих функций или модуля `welltest.functions`.

```{python}
#| code-fold: false
#| echo: true
"""
 Определим функции для перевода размерных переменных в безразмерные и обратно.
 Пригодится для построения графиков и ведения расчетов.
"""
def r_from_rd_m(rd, rw_m=0.1):
    """
    Перевод безразмерного расстояния в размерное
    rd -  безразмерное расстояние
    rw_m -  радиус скважины, м
    """
    return rd * rw_m

def rd_from_r(r_m, rw_m=0.1):
    """
    Перевод размерного расстояния в безразмерное
    r_m - размерное расстояние, м
    rw_m - радиус скважины, м
    """
    return r_m / rw_m

def t_from_td_hr(td, k_mD=10, phi=0.2, mu_cP=1, ct_1atm=1e-5, rw_m=0.1):
    """
    Перевод безразмерного времени в размерное, результат в часах
    td - безразмерное время
    k_mD - проницаемость пласта, мД
    phi - пористость, доли единиц
    mu_cP - динамическая вязкость флюида, сП
    ct_1atm - общая сжимаемость, 1/атм
    rw_m - радиус скважины, м
    """
    return td * phi * mu_cP * ct_1atm * rw_m * rw_m / k_mD / 0.00036

def td_from_t(t_hr, k_mD=10, phi=0.2, mu_cP=1, ct_1atm=1e-5, rw_m=0.1):
    """
    Перевод размерного времени в безразмерное
    t_hr - размерное время, час
    k_mD - проницаемость пласта, мД
    phi - пористость, доли единиц
    mu_cP - динамическая вязкость флюида, сП
    ct_1atm - общая сжимаемость, 1/атм
    rw_m - радиус скважины, м
    """
    return  0.00036 * t_hr * k_mD / (phi * mu_cP * ct_1atm * rw_m * rw_m) 

def p_from_pd_atma(pd, 
                   k_mD=10, h_m=10, 
                   q_sm3day=20, b_m3m3=1.2, mu_cP=1, pi_atma=250):
    """
    Перевод безразмерного давления в размерное, результат 
    в абсолютных атмосферах
    pd - безразмерное давление
    k_mD - проницаемость пласта, мД
    h_m - мощность пласта, м
    q_sm3day - дебит на поверхности, м3/сут в с.у.
    fvf_m3m3 - объемный коэффициент нефти, м3/м3
    mu_cP - динамическая вязкость флюида, сП
    pi_atma - начальное давление, абсолютные атм.
    """
    return pi_atma - pd * 18.42 * q_sm3day * b_m3m3 * mu_cP / k_mD / h_m 

def pd_from_p(p_atma, 
              k_mD=10, h_m=10, 
              q_sm3day=20, b_m3m3=1.2, mu_cP=1, pi_atma=250):
    """
    Перевод размерного давления в безразмерное
    p_atma - давление
    k_mD - проницаемость пласта, мД
    h_m - мощность пласта, м
    q_sm3day - дебит на поверхности, м3/сут в с.у.
    fvf_m3m3 - объемный коэффициент нефти, м3/м3
    mu_cP - динамическая вязкость флюида, сП
    pi_atma - начальное давление, абсолютные атм.
    """
    return (pi_atma - p_atma) / (18.42*q_sm3day*b_m3m3*mu_cP) * k_mD * h_m 

def q_from_qd_sm3day(qd, q_ref_sm3day=1):
    """
    Перевод безразмерного дебита скважины в размерный
    qd - безразмерный дебит скважины
    q_ref_sm3day - референсный дебит
    """
    return  qd * q_ref_sm3day / 2 / np.pi

def qd_from_q(q_sm3day, q_ref_sm3day=1):
    """
    Перевод размерного дебита в безразмерные
    q_sm3day -  дебит скважины, ст. м3/сут
    q_ref_sm3day - референсный дебит
    """
    return 2 * np.pi * q_sm3day / q_ref_sm3day
```
